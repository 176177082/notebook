<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-01-09 周六 19:47 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SQL Server</title>
<meta name="generator" content="Org mode">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://rgb-24bit.github.io/blog/misc/style.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125860001-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125860001-1');
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="https://rgb-24bit.github.io/notebook/"> UP </a>
 |
 <a accesskey="H" href="https://rgb-24bit.github.io"> HOME </a>
</div><div id="content">
<h1 class="title">SQL Server</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org30d34c0">1. 使用 C# 操作 SQL Server</a>
<ul>
<li><a href="#orgd6b1bd3">1.1. 五大核心组件</a></li>
<li><a href="#orgb5f4564">1.2. Connection 类</a></li>
<li><a href="#org8df023b">1.3. Command 类</a></li>
<li><a href="#org6fa89d5">1.4. DataAdaper 类</a></li>
<li><a href="#orge105e32">1.5. DataReader 类</a></li>
<li><a href="#orgfe216b6">1.6. DataSet 类</a></li>
<li><a href="#org8cdc53f">1.7. 简单使用总结</a></li>
</ul>
</li>
<li><a href="#org247b13a">2. T-SQL 使用</a></li>
<li><a href="#orgde2ebce">3. 相关问题</a>
<ul>
<li><a href="#orgb68a83c">3.1. 通过 T-SQL 语句备份还原数据库</a></li>
<li><a href="#org961ccee">3.2. 删除已存在的数据库</a></li>
<li><a href="#org1ce0de4">3.3. 通过 T-SQL 语句创建数据库</a></li>
<li><a href="#org3763ca0">3.4. 怎样在 SQL Server 中进行分页查询</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org30d34c0" class="outline-2">
<h2 id="org30d34c0"><span class="section-number-2">1</span> 使用 C# 操作 SQL Server</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li><a href="http://www.cnblogs.com/rainman/archive/2012/03/13/2393975.html">C# 操作 SQL Server 数据库</a></li>
</ul>
</div>

<div id="outline-container-orgd6b1bd3" class="outline-3">
<h3 id="orgd6b1bd3"><span class="section-number-3">1.1</span> 五大核心组件</h3>
<div class="outline-text-3" id="text-1-1">
<dl class="org-dl">
<dt>Connection</dt><dd>数据库连接</dd>
<dt>Command</dt><dd>数据库的命令</dd>
<dt>DataSet</dt><dd>数据集</dd>
<dt>DataReader</dt><dd>数据库的读取器</dd>
<dt>DataAdaper</dt><dd>数据库的适配器</dd>
</dl>
</div>
</div>
<div id="outline-container-orgb5f4564" class="outline-3">
<h3 id="orgb5f4564"><span class="section-number-3">1.2</span> Connection 类</h3>
<div class="outline-text-3" id="text-1-2">
<p>
和数据库交互, 必须连接它.
</p>

<p>
连接帮助指明数据库服务器, 数据库名字, 用户名, 密码, 和连接数据库所需要的其它参数.
</p>

<p>
Connection 对象会被 Command 对象使用, 这样就能够知道是在哪个数据源上面执行命令.
</p>

<p>
与数据库交互的过程意味着必须指明想要执行的操作, 这是依靠 Command 对象执行的.
</p>

<p>
开发人员使用 Command 对象来发送 SQL 语句给数据库.
</p>

<p>
Command 对象使用 Connection 对象来指出与哪个数据源进行连接.
</p>

<p>
开发人员能够单独使用 Command 对象来直接执行命令,
或者将一个 Command 对象的引用传递给 DataAdapter, 它保存了一组能够操作下面描述的一组数据的命令.
</p>

<p>
<b>属性:</b>
</p>
<dl class="org-dl">
<dt>ConnectionString</dt><dd>打开或连接数据库的字符串</dd>
<dt>ConnectionTimeOut</dt><dd>尝试建立连接时终止尝试并生成错误之前所等待的时间</dd>
<dt>Database</dt><dd>获取当前打开的数据库</dd>
<dt>State</dt><dd>连接到当前状态</dd>
<dt>DataSourse</dt><dd><p>
获取打开数据库的连接实例
</p>

<p>
<b>方法:</b>
</p>
<dl class="org-dl">
<dt>open</dt><dd>打开数据库连接</dd>
<dt>close</dt><dd>关闭数据库连接</dd>
<dt>CreateCommand</dt><dd>创建并返回一个与该链接相关联的Command对象</dd>
<dt>BeginTransation</dt><dd>开始数据库事物</dd>
<dt>ChangeDatabase</dt><dd>更改当前打开的数据库</dd>
</dl></dd>
</dl>
</div>
</div>

<div id="outline-container-org8df023b" class="outline-3">
<h3 id="org8df023b"><span class="section-number-3">1.3</span> Command 类</h3>
<div class="outline-text-3" id="text-1-3">
<p>
成功与数据建立连接后, 就可以用 Command 对象来执行查询, 修改, 插入, 删除等命令
</p>

<p>
Command 对象常用的方法有 ExecuteReader() 方法, ExecuteScalar() 方法和 ExecuteNonQuery() 方法
</p>

<p>
插入数据可用 ExecuteNonQuery() 方法来执行插入命令
</p>

<p>
<b>属性:</b>
</p>
<dl class="org-dl">
<dt>Connection</dt><dd>设置或获取Command对象使用的Connection对象实例</dd>
<dt>ConnectionType</dt><dd>(设置或获取执行语句的类型)
<dl class="org-dl">
<dt>StoredProceduce</dt><dd>储存过程</dd>
<dt>TableDirectText</dt><dd>标准的SQL语句</dd>
<dt>Text</dt><dd>默认</dd>
</dl></dd>
<dt>CommandText</dt><dd>设置或获取需要执行的sql语句或储存过程名</dd>
<dt>Parameter</dt><dd><p>
取得参数值集合
</p>

<p>
<b>方法:</b>
</p>
<dl class="org-dl">
<dt>ExecuteReader</dt><dd>执行CommandText指定的SQL语句或储存过程名, 返回值类型为DataReader</dd>
<dt>ExecuteNonQuery</dt><dd>执行后不返回任何行, 对于update, insert, delete语句, 返回影响的行数对于其他类型的语句, 返回值为-1</dd>
<dt>ExecuteScalar</dt><dd>返回第一个结果集中的第一行中的第一列数据</dd>
<dt>ExecuteXMLReader</dt><dd>将CommandText发送到Connection并生成一个XmlReader</dd>
</dl></dd>
</dl>
</div>
</div>

<div id="outline-container-org6fa89d5" class="outline-3">
<h3 id="org6fa89d5"><span class="section-number-3">1.4</span> DataAdaper 类</h3>
<div class="outline-text-3" id="text-1-4">
<p>
某些时候开发人员使用的数据主要是只读的, 并且开发人员很少需要将其改变至底层的数据源
</p>

<p>
同样一些情况要求在内存中缓存数据, 以此来减少并不改变的数据被数据库调用的次数
</p>

<p>
DataAdapter 通过断开模型来帮助开发人员方便的完成对以上情况的处理
</p>

<p>
当在一单批次的对数据库的读写操作的持续的改变返回至数据库的时候,  DataAdapter 填充(fill) DataSet 对象
</p>

<p>
DataAadapter 包含对连接对象以及当对数据库进行读取或者写入的时候自动的打开或者关闭连接的引用
</p>

<p>
另外, DataAdapter 包含对数据的 SELECT, INSERT, UPDATE 和 DELETE 操作的 Command 对象引用
</p>

<p>
开发人员将为 DataSet 中的每一个 Table 都定义 DataAadapter, 它将为开发人员照顾所有与数据库的连接
</p>

<p>
所以开发人员将做的工作是告诉 DataAdapter 什么时候装载或者写入到数据库
</p>

<p>
<b>属性:</b>
</p>
<dl class="org-dl">
<dt>SelectCommand</dt><dd>用于设置从记录集中选择记录的命令</dd>
<dt>InsertCommand</dt><dd>用于设置从记录集中添加记录的命令</dd>
<dt>UpdateCommand</dt><dd>用于设置从记录集中更新记录的命令</dd>
<dt>DeleteCommand</dt><dd><p>
用于设置从记录集中删除记录的命令
</p>

<p>
<b>方法:</b>
</p>
<dl class="org-dl">
<dt>Fill</dt><dd>用于在DataSet中添加或者刷新行</dd>
<dt>FillSchema</dt><dd>用于将DataTable添加到DataSet中, 并匹配与数据源匹配的框架</dd>
<dt>GetFillParameters</dt><dd>获取当前执行SQL的SELECT语句时用户设置参数</dd>
<dt>Update</dt><dd>用于对DataSet记录集进行操作</dd>
<dt>Dispose</dt><dd>用于销毁SQLDataAdaper对象</dd>
</dl></dd>
</dl>
</div>
</div>

<div id="outline-container-orge105e32" class="outline-3">
<h3 id="orge105e32"><span class="section-number-3">1.5</span> DataReader 类</h3>
<div class="outline-text-3" id="text-1-5">
<p>
许多数据操作要求开发人员只是读取一串数据
</p>

<p>
DataReader 对象允许开发人员获得从 Command 对象的 SELECT 语句得到的结果
</p>

<p>
考虑性能的因素, 从 DataReader 返回的数据都是快速的且只是"向前"的数据流
</p>

<p>
这意味着开发人员只能按照一定的顺序从数据流中取出数据
</p>

<p>
这对于速度来说是有好处的, 但是如果开发人员需要操作数据, 更好的办法是使用 DataSet
</p>

<p>
<b>属性:</b>
</p>
<dl class="org-dl">
<dt>FiledCount</dt><dd>显示当前数据记录的字段总和</dd>
<dt>IsClosed</dt><dd><p>
判断 DataReader对象是否已经关闭
</p>

<p>
<b>方法:</b>
</p>
<dl class="org-dl">
<dt>Close</dt><dd>关闭DataReader对象</dd>
<dt>GetString</dt><dd>以String类型返回指定列中的对象</dd>
<dt>Getvalue</dt><dd>以自身的类型返回指定列中值</dd>
<dt>Getvalues</dt><dd>返回当前记录所有字段的集合</dd>
<dt>Read</dt><dd>将光标指向DataReader对象的下一记录</dd>
</dl></dd>
</dl>
</div>
</div>
<div id="outline-container-orgfe216b6" class="outline-3">
<h3 id="orgfe216b6"><span class="section-number-3">1.6</span> DataSet 类</h3>
<div class="outline-text-3" id="text-1-6">
<p>
DataSet 对象是数据在内存中的表示形式
</p>

<p>
它包括多个DataTable对象, 而DataTable包含列和行, 就象一个普通的数据库中的表。
</p>

<p>
开发人员甚至能够定义表之间的关系来创建主从关系
</p>

<p>
DataSet是在特定的场景下使用――帮助管理内存中的数据并支持对数据的断开操作的
</p>

<p>
DataSet是被所有Data Providers使用的对象, 因此它并不像Data Provider一样需要特别的前缀
</p>

<p>
DataSet 这个对象可以视为一个暂存区(Cache), 可以把从数据库中所查询到的数据保留起来, 甚至可以将整个数据库显示出来
</p>

<p>
DataSet 的能力不只是可以储存多个Table 而已, 还可以透过DataSetCommand 对象取得一些例如主键等的数据表结构, 并可以记录数据表间的关联
</p>

<p>
DataSet 对象可以说是ADO.NET 中重量级的对象, 这个对象架构在DataSetCommand 对象上, 本身不具备和数据源沟通的能力
</p>

<p>
也就是说我们是将DataSetCommand 对象当做DataSet 对象以及数据源间传输数据的桥梁
</p>
</div>
</div>

<div id="outline-container-org8cdc53f" class="outline-3">
<h3 id="org8cdc53f"><span class="section-number-3">1.7</span> 简单使用总结</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li>Connection 类建立连接, 连接字符串用于声明连接对象</li>
<li>Command 类, 建立命令对象类, 用于执行SQL指令, 可以用初始命令和数据库链接对象实例化</li>
<li>DataAdapter类, 数据库适配器, 用于在必要时对数据库建立连接, 内置命令对象, 可以用 sqlcmd 对象实例化</li>
<li>DataReader 类, 保存读取到的数据库数据, 若为读取到数据, Read() 方法返回值为false</li>
<li>DataSet类, 数据集, 保存从数据库中的数据, 结构类似数据库, 可以用 适配器的 Fill 方法进行填充</li>
<li>命令构建类, 通过适配器对象实例化, 用适配器对象的更新方法更新数据库中的数据, 更新方法参数为数据集对象</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org247b13a" class="outline-2">
<h2 id="org247b13a"><span class="section-number-2">2</span> T-SQL 使用</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>创建数据库的默认保存位置为用户目录</li>

<li>获取当前连接的数据库名: Print DB_NAME()</li>

<li>默认连接数据库为 master</li>

<li><p>
查询当前数据库中所有表名
</p>
<div class="org-src-container">
<pre class="src src-sql">// xtype=<span class="org-string">'U'</span>: &#34920;&#31034;&#25152;&#26377;&#29992;&#25143;&#34920;, xtype=<span class="org-string">'S'</span>: &#34920;&#31034;&#25152;&#26377;&#31995;&#32479;&#34920;
  <span class="org-keyword">select</span> * <span class="org-keyword">from</span> sysobjects <span class="org-keyword">where</span> xtype=<span class="org-string">'U'</span>
</pre>
</div></li>

<li><p>
获取所有数据库名
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">select</span> <span class="org-keyword">name</span> <span class="org-keyword">from</span> master.dbo.sysdatabases;
</pre>
</div></li>

<li><p>
查询指定表中的所有字段名
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">select</span> <span class="org-keyword">name</span> <span class="org-keyword">from</span> syscolumns <span class="org-keyword">where</span> id=Object_Id(<span class="org-string">'table_name'</span>)
</pre>
</div></li>

<li>T-SQL 变量不能直接当做命令使用, 要看其值, 用 Print</li>

<li id=":r 指令">执行指定路径的 sql 脚本, Sqlcmd 指令</li>

<li><p>
密码修改
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">exec</span> sp_password <span class="org-keyword">NULL</span>, <span class="org-string">'newpas'</span>, <span class="org-string">'login_name'</span>;

<span class="org-keyword">ALTER</span> LOGIN sa <span class="org-keyword">WITH</span> PASSWORD = <span class="org-string">'newpas'</span>;
</pre>
</div></li>

<li><p>
赋予登录权限
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">ALTER</span> LOGIN sa ENABLE;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgde2ebce" class="outline-2">
<h2 id="orgde2ebce"><span class="section-number-2">3</span> 相关问题</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgb68a83c" class="outline-3">
<h3 id="orgb68a83c"><span class="section-number-3">3.1</span> 通过 T-SQL 语句备份还原数据库</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li><p>
Back up the database to disk.
</p>
<div class="org-src-container">
<pre class="src src-sql">BACKUP DATABASE db <span class="org-keyword">TO</span> DISK = <span class="org-string">'/path/to/db.bak'</span>;
</pre>
</div></li>

<li><p>
Restore database from disk.
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">/**</span>
<span class="org-comment"> * If the restore failed because the corresponding attribute was not found, execute</span>
<span class="org-comment"> * RESTORE FILELISTONLY FROM DISK='/path/to/db.bak'</span>
<span class="org-comment"> * Get data file and log file name</span>
<span class="org-comment">   *</span>
<span class="org-comment"> * Note: The target directory must exist</span>
<span class="org-comment"> */</span>
RESTORE DATABASE db <span class="org-keyword">FROM</span> DISK = <span class="org-string">'/path/to/db.bak'</span>
  <span class="org-keyword">WITH</span> MOVE <span class="org-string">'db_data'</span> <span class="org-keyword">TO</span> <span class="org-string">'/path/to/db_data.mdf'</span>,
  MOVE <span class="org-string">'db_log'</span>  <span class="org-keyword">TO</span> <span class="org-string">'/path/to/db_log.ldf'</span>;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org961ccee" class="outline-3">
<h3 id="org961ccee"><span class="section-number-3">3.2</span> 删除已存在的数据库</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-sql">IF <span class="org-keyword">EXISTS</span> (<span class="org-keyword">SELECT</span> * <span class="org-keyword">FROM</span> sys.databases <span class="org-keyword">WHERE</span> <span class="org-keyword">name</span> = <span class="org-string">'db'</span>)
  <span class="org-keyword">DROP</span> DATABASE db;
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ce0de4" class="outline-3">
<h3 id="org1ce0de4"><span class="section-number-3">3.3</span> 通过 T-SQL 语句创建数据库</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">CREATE</span> DATABASE db
  <span class="org-keyword">ON</span>
  (
    <span class="org-keyword">name</span> = db_data,
    filename = <span class="org-string">'/path/to/db_data.mdf'</span>
  )
  LOG <span class="org-keyword">ON</span>
  (
    <span class="org-keyword">name</span> = db_log,
    filename = <span class="org-string">'/path/to/db_log.ldf'</span>
  );
</pre>
</div>
</div>
</div>

<div id="outline-container-org3763ca0" class="outline-3">
<h3 id="org3763ca0"><span class="section-number-3">3.4</span> 怎样在 SQL Server 中进行分页查询</h3>
<div class="outline-text-3" id="text-3-4">
<p>
在 SQL Server 2012 以上的版本中，可以使用如下的方式：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SELECT</span> * <span class="org-keyword">FROM</span> <span class="org-keyword">TABLE</span> <span class="org-keyword">ORDER</span> <span class="org-keyword">BY</span> ? OFFSET (@pageSize * (@pageIndex - 1)) <span class="org-keyword">ROWS</span> <span class="org-keyword">FETCH</span> <span class="org-keyword">NEXT</span> @pageSize <span class="org-keyword">ROWS</span> <span class="org-keyword">ONLY</span>
</pre>
</div>

<p>
需要注意的是，OFFSET 是 ORDER BY 的字句，必须在 ORDER BY 之后使用，可以参考：
</p>
<ul class="org-ul">
<li><a href="http://www.sqlservertutorial.net/sql-server-basics/sql-server-offset-fetch/">SQL Server OFFSET FETCH: Limit The Number of Rows Returned</a></li>
</ul>

<p>
在 SQL Server 2012 以前的版本，可以参考：
</p>
<ul class="org-ul">
<li><a href="http://zhiheng.me/149">SQL Server 数据库的分页查询 | zhiheng</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
版权声明：本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'rgb-24bit';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
</div>
</body>
</html>
