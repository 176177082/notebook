<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-01-09 周六 19:47 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>相关问题</title>
<meta name="generator" content="Org mode">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://rgb-24bit.github.io/blog/misc/style.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125860001-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125860001-1');
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="https://rgb-24bit.github.io/notebook/"> UP </a>
 |
 <a accesskey="H" href="https://rgb-24bit.github.io"> HOME </a>
</div><div id="content">
<h1 class="title">相关问题</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdd6cc32">1. MySQL 中 Schema 和 Database 的区别是什么</a></li>
<li><a href="#org7b159b4">2. 时区陷阱问题</a></li>
<li><a href="#org9b66086">3. 怎样执行 SQL 脚本</a></li>
<li><a href="#org97eb08b">4. 怎样通过远程主机进行访问</a></li>
<li><a href="#orgb182906">5. 怎样在数据存在时更新不存在时插入</a></li>
<li><a href="#org7b6e453">6. 怎样显示 Table 的元数据信息</a></li>
<li><a href="#org0eab885">7. COUNT(&lowast;) 和 COUNT(1)</a></li>
<li><a href="#orge92b792">8. 怎样修改列值为允许为空</a></li>
<li><a href="#org6fd159c">9. 语句 ON DUPLICATE KEY UPDATE 的受影响行数</a></li>
<li><a href="#orgddbb09d">10. MySQL 中的 SELECT 和 GROUP BY</a></li>
<li><a href="#orgc051282">11. MySQL 中 UPDATE 语句影响行数为 0 的问题</a></li>
<li><a href="#org1cbb78e">12. MySQL 如何对死锁进行检测</a></li>
<li><a href="#org835f540">13. MySQL 中 VARCHAR 类型到底能存多少汉字</a></li>
<li><a href="#org20b3928">14. JOIN USING 和 JOIN ON</a></li>
<li><a href="#orgdbd0bbb">15. MySQL 中比较操作对于字符串尾空字符的处理</a></li>
<li><a href="#org2c85941">16. MySQL 时间字段格式如何选择，TIMESTAMP，DATETIME，INT？</a></li>
<li><a href="#orgdf13f70">17. How To Delete Duplicate Rows in MySQL</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgdd6cc32" class="outline-2">
<h2 id="orgdd6cc32"><span class="section-number-2">1</span> MySQL 中 Schema 和 Database 的区别是什么</h2>
<div class="outline-text-2" id="text-1">
<p>
MySQL 中 Schema 和 Database 在语义上是等价的，两者可以等价替换。
</p>

<p>
参考：<a href="https://stackoverflow.com/questions/11618277/difference-between-schema-database-in-mysql">Difference Between Schema / Database in MySQL - Stack Overflow</a>
</p>
</div>
</div>

<div id="outline-container-org7b159b4" class="outline-2">
<h2 id="org7b159b4"><span class="section-number-2">2</span> 时区陷阱问题</h2>
<div class="outline-text-2" id="text-2">
<p>
<code>mysql</code> 6.0 以上的版本需要在链接字符串中假设参数 <code>serverTimezone</code> 指定时区：
</p>
<div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"jdbc:mysql://localhost:3306/springdatastudy?serverTimezone=UTC"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>

<p>
但是设置 <code>UTC</code> 时区可能导致时间精度的问题， 因此可以设置为中国标准时间：
</p>
<div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"jdbc:mysql://localhost:3306/springdatastudy?serverTimezone=Asia/Shanghai"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b66086" class="outline-2">
<h2 id="org9b66086"><span class="section-number-2">3</span> 怎样执行 SQL 脚本</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-bash">mysql&gt; source /path/to/script
</pre>
</div>
</div>
</div>

<div id="outline-container-org97eb08b" class="outline-2">
<h2 id="org97eb08b"><span class="section-number-2">4</span> 怎样通过远程主机进行访问</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>更改配置文件中的 <code>bind-address</code> 为 <code>0.0.0.0</code>, 配置文件在 <code>/etc/mysql/</code>, 使得允许远程主机访问</li>
<li><p>
更改用户的 <code>host</code> 为 <code>%</code>, 允许该用户进行远程访问
</p>
<div class="org-src-container">
<pre class="src src-sql">&gt; use mysql;
&gt; <span class="org-keyword">UPDATE</span> <span class="org-builtin">USER</span> <span class="org-keyword">SET</span> <span class="org-keyword">HOST</span>=<span class="org-string">'%'</span> <span class="org-keyword">WHERE</span> <span class="org-builtin">user</span>=<span class="org-string">'user_name'</span>;
</pre>
</div></li>
<li><p>
通过如下方式创建拥有所有权限可远程访问的用户
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">CREATE</span> <span class="org-builtin">USER</span> <span class="org-string">'user'</span>@<span class="org-string">'%'</span> IDENTIFIED <span class="org-keyword">BY</span> <span class="org-string">'password'</span>;

<span class="org-keyword">GRANT</span> <span class="org-keyword">ALL</span> <span class="org-keyword">PRIVILEGES</span> <span class="org-keyword">ON</span> *.* <span class="org-keyword">TO</span> <span class="org-string">'user'</span>@<span class="org-string">'%'</span> = <span class="org-keyword">WITH</span> <span class="org-keyword">GRANT</span> <span class="org-keyword">OPTION</span>;

FLUSH <span class="org-keyword">PRIVILEGES</span>;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb182906" class="outline-2">
<h2 id="orgb182906"><span class="section-number-2">5</span> 怎样在数据存在时更新不存在时插入</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-sql">IF <span class="org-keyword">EXISTS</span>(<span class="org-keyword">SELECT</span> * <span class="org-keyword">FROM</span> tbl <span class="org-keyword">WHERE</span> id = 30122)
  <span class="org-keyword">UPDATE</span> tbl <span class="org-keyword">SET</span> <span class="org-keyword">name</span> = <span class="org-string">'john'</span> <span class="org-keyword">WHERE</span> id = 3012
<span class="org-keyword">ELSE</span>
  <span class="org-keyword">INSERT</span> <span class="org-keyword">INTO</span> tbl(<span class="org-keyword">name</span>) <span class="org-keyword">VALUES</span>(<span class="org-string">'john'</span>);
</pre>
</div>

<p>
如果存在键约束的话，也可以选择使用：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">INSERT</span> ... <span class="org-keyword">ON</span> DUPLICATE <span class="org-keyword">KEY</span> <span class="org-keyword">UPDATE</span> ...
</pre>
</div>

<p>
参考：<a href="https://stackoverflow.com/questions/548541/insert-ignore-vs-insert-on-duplicate-key-update">mysql - "INSERT IGNORE" vs "INSERT &#x2026; ON DUPLICATE KEY UPDATE" - Stack Overflow</a>
</p>
</div>
</div>

<div id="outline-container-org7b6e453" class="outline-2">
<h2 id="org7b6e453"><span class="section-number-2">6</span> 怎样显示 Table 的元数据信息</h2>
<div class="outline-text-2" id="text-6">
<p>
通过 <code>SHOW COLUMNS FROM tblName</code> 可以显示表的元数据信息，但是也可以通过 <code>DESCRIBE tblName</code> 快速查询。
</p>
</div>
</div>

<div id="outline-container-org0eab885" class="outline-2">
<h2 id="org0eab885"><span class="section-number-2">7</span> COUNT(&lowast;) 和 COUNT(1)</h2>
<div class="outline-text-2" id="text-7">
<p>
常见的一个需求就是通过 <code>COUNT</code> 函数来统计行数，其中一个问题就是 <code>COUNT(\ast)</code> 和 <code>COUNT(1)</code> 这两种写法的性能问题。
</p>

<p>
这在 <code>5.7</code> 的文档中有相应的描述，对于 InnoDB 引擎来说，两种写法没有区别：
</p>
<blockquote>
<p>
InnoDB handles SELECT COUNT(*) and SELECT COUNT(1) operations in the same way. There is no performance difference.
</p>
</blockquote>

<p>
对于 MyISAM 引擎来说，似乎 <code>COUNT(*)</code> 的写法会更好：
</p>
<blockquote>
<p>
For MyISAM tables, COUNT(*) is optimized to return very quickly if the SELECT retrieves from one table, no other columns are retrieved, and there is no WHERE clause.
</p>

<p>
This optimization only applies to MyISAM tables, because an exact row count is stored for this storage engine and can be accessed very quickly. COUNT(1) is only subject to the same optimization if the first column is defined as NOT NULL.
</p>
</blockquote>

<p>
官方文档链接：<a href="https://dev.mysql.com/doc/refman/5.7/en/group-by-functions.html#function_count">MySQL :: MySQL 5.7 Reference Manual :: COUNT(expr)</a>
</p>

<p>
如果继续查阅文档，可以发现，即使在更早的版本 <code>5.5</code> 中，关于 COUNT 函数的描述也是一样的，因此，用 <code>COUNT(*)</code> 就可以了。
</p>

<p>
但是，在实际的使用中，我们编写的 SQL 语句在到达数据库之前，可能会将 * 转换为列名，因此，在这种情况下，使用 <code>COUNT(1)</code> 更好。
</p>
</div>
</div>

<div id="outline-container-orge92b792" class="outline-2">
<h2 id="orge92b792"><span class="section-number-2">8</span> 怎样修改列值为允许为空</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">ALTER</span> <span class="org-keyword">TABLE</span> <span class="org-function-name">mytable</span> <span class="org-keyword">MODIFY</span> mycolumn <span class="org-type">VARCHAR</span>(255);
</pre>
</div>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/212939/how-do-i-modify-a-mysql-column-to-allow-null">syntax - How do I modify a MySQL column to allow NULL? - Stack Overflow</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6fd159c" class="outline-2">
<h2 id="org6fd159c"><span class="section-number-2">9</span> 语句 ON DUPLICATE KEY UPDATE 的受影响行数</h2>
<div class="outline-text-2" id="text-9">
<blockquote>
<p>
With ON DUPLICATE KEY UPDATE, the affected-rows value per row is 1 if the row is inserted as a new row and 2 if an existing row is updated.
</p>
</blockquote>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/3747314/why-are-2-rows-affected-in-my-insert-on-duplicate-key-update">mysql - Why are 2 rows affected in my `INSERT &#x2026; ON DUPLICATE KEY UPDATE`? - Stack Overflow</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgddbb09d" class="outline-2">
<h2 id="orgddbb09d"><span class="section-number-2">10</span> MySQL 中的 SELECT 和 GROUP BY</h2>
<div class="outline-text-2" id="text-10">
<p>
在 SQL Server 中，SELECT 只能查询在 GROUP BY 子句中出现的字段，但是在 MySQL 中，如果 SELECT 中存在不在 GROUP BY 子句中的字段，就会任意选择一行数据数据。
</p>

<p>
每次用 MySQL 都以为我记错了 QAQ
</p>

<p>
参考：
</p>
<blockquote>
<p>
A MySQL extension permits a column that does not appear in the GROUP BY list to be named in the select list. (For information about nonaggregated columns and GROUP BY, see Section 12.20.3, “MySQL Handling of GROUP BY”.)
In this case, the server is free to choose any value from this nonaggregated column in summary rows, and this includes the extra rows added by WITH ROLLUP. 
</p>
</blockquote>

<p>
<a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-modifiers.html">MySQL :: MySQL 8.0 Reference Manual :: 12.20.2 GROUP BY Modifiers</a>
</p>
</div>
</div>

<div id="outline-container-orgc051282" class="outline-2">
<h2 id="orgc051282"><span class="section-number-2">11</span> MySQL 中 UPDATE 语句影响行数为 0 的问题</h2>
<div class="outline-text-2" id="text-11">
<p>
MySQL 在官方文档中的描述：
</p>
<blockquote>
<p>
If you set a column to the value it currently has, MySQL notices this and does not update it.
</p>
</blockquote>

<p>
也就是说，当要更新的值和原始值一样时，MySQL 就不会执行更新，当所有值都一样时，就不会进行修改，影响行数自然为 0。
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/2186887/mysql-update-query-returns-0-rows-affected">mySQL UPDATE query returns "0 rows affected" - Stack Overflow</a></li>
</ul>
</div>
</div>

<div id="outline-container-org1cbb78e" class="outline-2">
<h2 id="org1cbb78e"><span class="section-number-2">12</span> MySQL 如何对死锁进行检测</h2>
<div class="outline-text-2" id="text-12">
<p>
有两种方式：
</p>
<ol class="org-ol">
<li>当事务等待时间超过一定时间时就认为存在死锁，这时会选择回滚等待的事务中的一个或多个</li>
<li>通过 wait-for graph 算法进行检测，当存在环路时就认为出现了死锁</li>
</ol>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://www.cnblogs.com/lbser/p/5183300.html">mysql 死锁问题分析 - zhanlijun - 博客园</a></li>
</ul>
</div>
</div>

<div id="outline-container-org835f540" class="outline-2">
<h2 id="org835f540"><span class="section-number-2">13</span> MySQL 中 VARCHAR 类型到底能存多少汉字</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>mysql 4.0 版本以下，varchar(50)，指的是 50 字节，如果存放 utf8 汉字时，只能存放 16 个（每个汉字 3 字节）</li>
<li>mysql 5.0 版本以上，varchar(50), 指的是 50 字符，无论存放的是数字、字母还是 UTF8 汉字，都可以存放 50 个</li>
</ul>
</div>
</div>

<div id="outline-container-org20b3928" class="outline-2">
<h2 id="org20b3928"><span class="section-number-2">14</span> JOIN USING 和 JOIN ON</h2>
<div class="outline-text-2" id="text-14">
<p>
USING 某种程度上来说算是一个语法糖，一些比较好的地方：
</p>
<ol class="org-ol">
<li><p>
当连接的两张表存在相同字段时，使用 USING 更加方便：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-comment">-- using</span>
<span class="org-keyword">SELECT</span> film.title, film_id <span class="org-comment">-- film_id is not prefixed</span>
<span class="org-keyword">FROM</span> film
<span class="org-keyword">JOIN</span> film_actor <span class="org-keyword">USING</span> (film_id)
<span class="org-keyword">WHERE</span> ...

<span class="org-comment">-- on</span>
<span class="org-keyword">SELECT</span> film.title, film.film_id <span class="org-comment">-- film.film_id is required here</span>
<span class="org-keyword">FROM</span> film
<span class="org-keyword">JOIN</span> film_actor <span class="org-keyword">ON</span> (film.film_id = film_actor.film_id)
<span class="org-keyword">WHERE</span> ...
</pre>
</div></li>
<li><code>SELECT *</code> 时 ON 会返回相同字段两次，而 USING 只返回一次</li>
</ol>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/11366006/mysql-on-vs-using">join - MySQL ON vs USING? - Stack Overflow</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgdbd0bbb" class="outline-2">
<h2 id="orgdbd0bbb"><span class="section-number-2">15</span> MySQL 中比较操作对于字符串尾空字符的处理</h2>
<div class="outline-text-2" id="text-15">
<p>
在测试环境中遇到的问题，执行类似如下的 SQL 时得到了 TRUE 结果：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SELECT</span> <span class="org-string">'string'</span> = <span class="org-string">'string   '</span>
</pre>
</div>

<p>
当场觉得 SQL 白学了，官方对此的文档是这样的(<a href="https://dev.mysql.com/doc/refman/8.0/en/charset-binary-collations.html#charset-binary-collations-trailing-space-comparisons">link</a>)：
</p>
<blockquote>
<p>
MySQL collations have a pad attribute, which has a value of PAD SPACE or NO PAD:
</p>
<ul class="org-ul">
<li>Most MySQL collations have a pad attribute of PAD SPACE.</li>
<li>The Unicode collations based on UCA 9.0.0 and higher have a pad attribute of NO PAD; see Section 10.10.1, “Unicode Character Sets”.</li>
</ul>

<p>
For nonbinary strings (CHAR, VARCHAR, and TEXT values), the string collation pad attribute determines treatment in comparisons of trailing spaces at the end of strings:
</p>
<ul class="org-ul">
<li>For PAD SPACE collations, trailing spaces are insignificant in comparisons; strings are compared without regard to trailing spaces.</li>
<li>NO PAD collations treat trailing spaces as significant in comparisons, like any other character.</li>
</ul>
</blockquote>

<p>
简单来说，对于大多数的编码方式来说，字符串的 = 比较是不会比较尾空串的……
</p>

<p>
可以通过 binary 关键字避免这一行为：
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">SELECT</span> <span class="org-type">BINARY</span> <span class="org-string">'string'</span> = <span class="org-string">'string   '</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c85941" class="outline-2">
<h2 id="org2c85941"><span class="section-number-2">16</span> MySQL 时间字段格式如何选择，TIMESTAMP，DATETIME，INT？</h2>
<div class="outline-text-2" id="text-16">
<p>
感觉三个类型都可以选择，各有优劣吧：
</p>
<ul class="org-ul">
<li>TIMESTAMP 和 DATETIME 都是事件类型，底层是用 INT 来表示的，但多了一层转换，查询时相对 INT 会慢一些</li>
<li>INT 在存储上的消耗会小一些，但相对的，需要自己来进行类型转换</li>
</ul>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://segmentfault.com/q/1010000000121702">Mysql 时间字段格式如何选择，TIMESTAMP，DATETIME，INT？ - SegmentFault 思否</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgdf13f70" class="outline-2">
<h2 id="orgdf13f70"><span class="section-number-2">17</span> How To Delete Duplicate Rows in MySQL</h2>
<div class="outline-text-2" id="text-17">
<p>
Delete duplicate rows using DELETE JOIN statement:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span class="org-keyword">DELETE</span> t1 <span class="org-keyword">FROM</span> contacts t1
       <span class="org-keyword">INNER</span> <span class="org-keyword">JOIN</span> contacts t2
 <span class="org-keyword">WHERE</span>
   t1.id &lt; t2.id <span class="org-keyword">AND</span>
   t1.email = t2.email;
</pre>
</div>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://www.mysqltutorial.org/mysql-delete-duplicate-rows/">How To Delete Duplicate Rows in MySQL</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
版权声明：本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'rgb-24bit';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
</div>
</body>
</html>
