<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-01-09 周六 19:44 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python 笔记</title>
<meta name="generator" content="Org mode">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://rgb-24bit.github.io/blog/misc/style.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125860001-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125860001-1');
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="https://rgb-24bit.github.io/notebook/"> UP </a>
 |
 <a accesskey="H" href="https://rgb-24bit.github.io"> HOME </a>
</div><div id="content">
<h1 class="title">Python 笔记</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org64e4e80">1. 函数</a>
<ul>
<li><a href="#org002cd72">1.1. 函数的默认参数</a></li>
<li><a href="#orge4094c6">1.2. 内置函数</a></li>
<li><a href="#orgc5d0ff9">1.3. 函数的属性</a></li>
</ul>
</li>
<li><a href="#orgc2d889d">2. 模块和包</a>
<ul>
<li><a href="#org15e6a08">2.1. 模块的导入</a></li>
<li><a href="#org7c22108">2.2. 模块相关概念</a></li>
<li><a href="#org05a093c">2.3. 包相关概念</a></li>
<li><a href="#orgcee62c9">2.4. 执行包与包内模块</a></li>
</ul>
</li>
<li><a href="#orgc4634f8">3. 类与实例</a>
<ul>
<li><a href="#org3bdbc67">3.1. 限制实例属性</a></li>
<li><a href="#org3f72d55">3.2. 抽象类</a></li>
<li><a href="#orge0fc6e0">3.3. 获取对象属性</a></li>
<li><a href="#org623c876">3.4. 保护成员和私有成员</a></li>
<li><a href="#org9851072">3.5. 内置成员</a></li>
<li><a href="#org61ed226">3.6. 生命周期</a></li>
</ul>
</li>
<li><a href="#orga168584">4. 作用域</a>
<ul>
<li><a href="#orgdab2129">4.1. 修改全局变量</a></li>
</ul>
</li>
<li><a href="#orgc34a170">5. 语法特性</a></li>
<li><a href="#orgc67066a">6. 注意事项</a></li>
</ul>
</div>
</div>

<div id="outline-container-org64e4e80" class="outline-2">
<h2 id="org64e4e80"><span class="section-number-2">1</span> 函数</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org002cd72" class="outline-3">
<h3 id="org002cd72"><span class="section-number-3">1.1</span> 函数的默认参数</h3>
<div class="outline-text-3" id="text-1-1">
<p>
当函数的关键字参数为 <b>引用类型</b> 时需要注意不要在函数体内部对参数直接修改：
</p>
<div class="org-src-container">
<pre class="src src-python">In [1]: <span class="org-keyword">def</span> <span class="org-function-name">func</span>(lst=[]):
   ...:     lst.append(10)
   ...:     <span class="org-keyword">print</span>(lst)
   ...:

In [2]: func
Out[2]: &lt;function __main__.func&gt;

In [3]: func()
[10]

In [4]: func()
[10, 10]

In [5]: func()
[10, 10, 10]
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4094c6" class="outline-3">
<h3 id="orge4094c6"><span class="section-number-3">1.2</span> 内置函数</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li><p>
内置函数 super 长用来调用父类的方法，一般形式为 <code>super(class, self)</code>, 可以参考：<a href="https://mozillazg.com/2016/12/python-super-is-not-as-simple-as-you-thought.html">Python: super 没那么简单 - Huang Huang 的博客</a>
</p>

<p>
当然，Python3 可以通过 <code>super()</code> 的形式调用。
</p></li>

<li>内置函数 staticmethod 通常作为装饰器使用，未被 <code>staticmethod</code> 装饰的方法， 如果没有绑定 <code>self</code> 变量，那么这个方法可以用类名访问， 但是不能用实例访问。使用 <code>staticmethod</code> 来装饰方法， 那么这个方法既可以使用类名访问，也可以使用实例访问。</li>

<li><p>
内置函数 iter 可以接受一个可调用对象和一个终止条件，当可调用对象的返回值等于终止条件时就结束迭代：
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-builtin">iter</span>(<span class="org-builtin">callable</span>, sentinel) -&gt; iterator
</pre>
</div></li>

<li>内置函数 dir 调用的是 <b>元类</b> 的 <code>__dir__</code>, 因此 <code>object.__dir__</code> 和 <code>dir</code> 得到的结果不一样</li>
</ul>
</div>
</div>

<div id="outline-container-orgc5d0ff9" class="outline-3">
<h3 id="orgc5d0ff9"><span class="section-number-3">1.3</span> 函数的属性</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<b>函数</b> 作为 <code>Python</code> 对象自然也可以有属性：
</p>
<div class="org-src-container">
<pre class="src src-python">In [1]: <span class="org-keyword">def</span> <span class="org-function-name">func</span>():
   ...:     <span class="org-keyword">pass</span>
   ...:

In [2]: func
Out[2]: &lt;function __main__.func&gt;

In [3]: <span class="org-variable-name">func.name</span> = <span class="org-string">'func'</span>

In [4]: func.name
Out[4]: <span class="org-string">'func'</span>
</pre>
</div>

<p>
这一特性的使用： <a href="https://stackoverflow.com/questions/338101/python-function-attributes-uses-and-abuses">Python function attributes - uses and abuses</a>.
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li><a href="https://segmentfault.com/a/1190000005701971">Python 实例方法的特殊属性</a></li>
<li><a href="https://segmentfault.com/a/1190000005685090">Python 自定义函数的特殊属性</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgc2d889d" class="outline-2">
<h2 id="orgc2d889d"><span class="section-number-2">2</span> 模块和包</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org15e6a08" class="outline-3">
<h3 id="org15e6a08"><span class="section-number-3">2.1</span> 模块的导入</h3>
<div class="outline-text-3" id="text-2-1">
<p>
导入模块时 Python 会动态执行一遍模块中的内容，函数或类的定义的执行就只是定义了函数或类，而其他语句会直接执行，如果有输出还会直接进行输出。
</p>

<p>
特别的，下面两行语句的效果是一样的：
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> spam
<span class="org-variable-name">spam</span> = <span class="org-builtin">__import__</span>(<span class="org-string">'spam'</span>, <span class="org-builtin">globals</span>(), <span class="org-builtin">locals</span>(), [], 0)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c22108" class="outline-3">
<h3 id="org7c22108"><span class="section-number-3">2.2</span> 模块相关概念</h3>
<div class="outline-text-3" id="text-2-2">
<p>
模块，在 <code>Python</code> 可理解为对应于一个文件。在创建了一个脚本文件后，定义了某些函数和变量。你在其他需要这些功能的文件中，导入这模块，就可重用这些函数和变量。
</p>

<p>
一般用 <code>module_name.fun_name</code>, 和 <code>module_name.var_name</code> 进行使用。这样的语义用法使模块看起来很像类或者名字空间，可将 <code>module_name</code> 理解为名字限定符。模块名就是文件名去掉 <code>.py</code> 后缀。
</p>

<p>
模块属性 <code>__name__</code>, 它的值由 <code>Python</code> 解释器设定。如果脚本文件是作为主程序调用，其值就设为 <code>__main__</code>, 如果是作为模块被其他文件导入，它的值就是其文件名。
</p>

<p>
模块能像包含函数定义一样，可包含一些可执行语句。这些可执行语句通常用来进行模块的初始化工作。这些语句 <b>只在模块第一次被导入时</b> 被执行。这非常重要，有些人以为这些语句会多次导入多次执行，其实不然。
</p>

<p>
模块在被导入执行时, <code>python</code> 解释器为加快程序的启动速度，会在与模块文件同一目录下生成 <code>.pyc</code> 文件。我们知道 <code>python</code> 是解释性的脚本语言，而 <code>.pyc</code> 是经过编译后的字节码，这一工作会自动完成，而无需程序员手动执行。
</p>
</div>
</div>

<div id="outline-container-org05a093c" class="outline-3">
<h3 id="org05a093c"><span class="section-number-3">2.3</span> 包相关概念</h3>
<div class="outline-text-3" id="text-2-3">
<p>
通常包总是一个目录，可以使用 <code>import</code> 导入包，或者 <code>from + import</code> 来导入包中的部分模块。包目录下为首的一个文件便是 <code>__init__.py</code>.
然后是一些模块文件和子目录，假如子目录中也有 <code>__init__.py</code> 那么它就是这个包的子包了。
</p>

<p>
创建许许多多模块后，我们可能希望将某些功能相近的文件组织在同一文件夹下，这里就需要运用包的概念了。包对应于文件夹，使用包的方式跟模块也类似，唯一需要注意的是，当文件夹当作包使用时，文件夹需要包含 <code>__init__.py</code> 文件，主要是为了避免将文件夹名当作普通的字符串。
<code>__init__.py</code> 的内容可以为空，一般用来进行包的某些初始化工作或者设置 <code>__all__</code> 值， <code>__all__</code> 是在 <code>from package-name import *</code> 这语句使用的，全部导出定义过的模块。
</p>

<p>
可以从包中导入单独的模块:
1). <code>import PackageA.SubPackageA.ModuleA</code>, 使用时必须用全路径名
2). 变种: <code>from PackageA.SubPackageA import ModuleA</code>, 可以直接使用模块名而不用加上包前缀。
3). 也可以直接导入模块中的函数或变量： <code>from PackageA.SubPackageA.ModuleA import functionA</code>
</p>

<p>
<code>import</code> 语句语法：
</p>
<ol class="org-ol">
<li>当使用 <code>from package import item</code> 时, <code>item</code> 可以是 <code>package</code> 的子模块或子包，或是其他的定义在包中的名字（比如一个函数、类或变量）。首先检查 <code>item</code> 是否定义在包中，不过没找到，就认为 <code>item</code> 是一个模块并尝试加载它，失败时会抛出一个 <code>ImportError</code> 异常。</li>

<li>当使用 <code>import item.subitem.subsubitem</code> 语法时，最后一个 <code>item</code> 之前的 <code>item</code> 必须是包，最后一个 <code>item</code> 可以是一个模块或包，但不能是类、函数和变量</li>

<li><p>
<code>from pacakge import *</code>
</p>

<p>
如果包的 <code>__init__.py</code> 定义了一个名为 <code>__all__</code> 的列表变量，它包含的模块名字的列表将作为被导入的模块列表。如果没有定义 <code>__all__</code>, 这条语句不会导入所有的 <code>package</code> 的子模块，它只保证包 <code>package</code> 被导入，然后导入定义在包中的所有名字。
</p></li>
</ol>

<p>
包是一个有层次的文件目录结构，它定义了由 n 个模块或 n 个子包组成的 python 应用程序执行环境。
</p>

<p>
通俗一点：包是一个包含 <code>__init__.py</code> 文件的目录，该目录下一定得有这个 <code>__init__.py</code> 文件和其它模块或子包
</p>
</div>
</div>

<div id="outline-container-orgcee62c9" class="outline-3">
<h3 id="orgcee62c9"><span class="section-number-3">2.4</span> 执行包与包内模块</h3>
<div class="outline-text-3" id="text-2-4">
<p>
如果你希望 <code>python</code> 将一个文件夹作为 <code>package</code> 对待，那么这个文件夹中必须包含一个名为 <code>__init__.py</code> 的文件，即使它是空的
</p>

<p>
如果你需要 <code>python</code> 讲一个文件夹作为 <code>package</code> 执行，那么这个文件夹中必须包含一个名为 <code>__main__.py</code> 的文件，当执行 <code>python -m pkg</code> 或者 <code>python pkg</code> 的时候，这个文件中的代码都会被执行
</p>

<p>
特别的， 对于包内的 <b>模块</b>, 如果使用了 <b>相对导入</b>, 那么可以使用 <code>python -m pkg.module</code> 指令执行模块.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc4634f8" class="outline-2">
<h2 id="orgc4634f8"><span class="section-number-2">3</span> 类与实例</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org3bdbc67" class="outline-3">
<h3 id="org3bdbc67"><span class="section-number-3">3.1</span> 限制实例属性</h3>
<div class="outline-text-3" id="text-3-1">
<p>
在 <code>Python</code> 中，每个类都有实例属性。默认情况下 <code>Python</code> 用一个字典来保存一个对象的实例属性。这非常有用，因为它允许我们在运行时去 <b>设置任意的新属性</b>
</p>

<p>
然而，对于有着已知属性的小类来说，它可能是个瓶颈。这个字典浪费了很多内存。 <code>Python</code> 不能在对象创建时直接分配一个固定量的内存来保存所有的属性。因此如果你创建许多对象（我指的是成千上万个），它会消耗掉很多内存。
</p>

<p>
不过还是有一个方法来规避这个问题。这个方法需要使用 <code>__slots__</code> 来告诉 <code>Python</code> 不要使用字典，而且只给一个固定集合的属性分配空间。
</p>

<p>
此时， <code>__slots__</code> 将为已声明的变量保留空间并阻止为每个实例自动创建 <code>__dict__</code> 和 <code>__weakref__</code>
</p>

<p>
简单来说， <code>__slots__</code> 的一个直接的作用便是减少内存消耗。
</p>

<p>
使用方式：
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">MyClass</span>(<span class="org-builtin">object</span>):
    <span class="org-variable-name">__slots__</span> = [<span class="org-string">'name'</span>, <span class="org-string">'identifier'</span>]
    <span class="org-keyword">def</span> <span class="org-function-name">__init__</span>(<span class="org-keyword">self</span>, name, identifier):
        <span class="org-keyword">self</span>.name = name
        <span class="org-keyword">self</span>.identifier = identifier
        <span class="org-keyword">self</span>.set_up()
        <span class="org-comment-delimiter"># </span><span class="org-comment">...</span>
</pre>
</div>

<p>
注意事项：
</p>
<ul class="org-ul">
<li>当从没有 <code>__slots__</code> 的类继承时， 该类的 <code>__dict__</code> 属性将始终可访问，因此子类中的 <code>__slots__</code> 定义没有意义</li>
<li>没有 <code>__dict__</code> 变量时， 实例不能被分配 <code>__slots__</code> 定义中未列出的新变量。 即不能随意设置变量</li>
<li>没有 <code>__weakref__</code> 变量， 定义 <code>__slots__</code> 的类不支持对其实例的弱引用。 如果需要弱引用支持， 则将 <code>__weakref__</code>
添加到 <code>__slots__</code> 声明的字符串序列中</li>
<li>类属性不能用于为由 <code>__slots__</code> 定义的实例变量设置默认值</li>
<li><code>__slots__</code> 声明的操作仅限于定义它的类， 子类将由一个 <code>__dict__</code>, 除非定义 <code>__slots__</code></li>
</ul>

<p>
参考：<a href="https://docs.python.org/3/reference/datamodel.html?highlight=__slots__#slots">3. Data model — Python 3.7.3 documentation</a>
</p>
</div>
</div>

<div id="outline-container-org3f72d55" class="outline-3">
<h3 id="org3f72d55"><span class="section-number-3">3.2</span> 抽象类</h3>
<div class="outline-text-3" id="text-3-2">
<p>
使用 <code>abc</code> 模块定义一个接口或抽象类，并且通过执行类型检查来确保子类实现了某些特定的方法。
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> abc <span class="org-keyword">import</span> ABCMeta, abstractmethod

<span class="org-keyword">class</span> <span class="org-type">IStream</span>(metaclass=ABCMeta):  <span class="org-comment-delimiter"># </span><span class="org-comment">only python3</span>
    <span class="org-type">@abstractmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">read</span>(<span class="org-keyword">self</span>, maxbytes=-1):
        <span class="org-keyword">pass</span>

    <span class="org-type">@abstractmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">write</span>(<span class="org-keyword">self</span>, data):
        <span class="org-keyword">pass</span>
</pre>
</div>

<p>
注意：
</p>
<ul class="org-ul">
<li>抽象类不能实例化</li>
<li>抽象类的子类必须实现特定的抽象方法</li>
</ul>

<p>
参考：<a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c08/p12_define_interface_or_abstract_base_class.html">8.12 定义接口或者抽象基类 — python3-cookbook 3.0.0 文档</a>
</p>
</div>
</div>

<div id="outline-container-orge0fc6e0" class="outline-3">
<h3 id="orge0fc6e0"><span class="section-number-3">3.3</span> 获取对象属性</h3>
<div class="outline-text-3" id="text-3-3">
<p>
方法 <code>__getattr__</code> 和 <code>__getattribute__</code> 的使用：
</p>
<ul class="org-ul">
<li>__getattr__(self, attr)
<ul class="org-ul">
<li>触发时机：获取不存在的对象成员时触发</li>
<li>作用：为访问不存在的属性设置值</li>
<li>注意：__getattribute__() 无论何时都会在 __getattr__() 之前触发，触发了 __getattribute__() <b>有返回值</b> 就不会在触发 __getattr__() 了</li>
</ul></li>

<li>__getattribute__(self, attr)
<ul class="org-ul">
<li>触发时机：使用对象成员时触发，无论成员是否存在</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org623c876" class="outline-3">
<h3 id="org623c876"><span class="section-number-3">3.4</span> 保护成员和私有成员</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li><p>
<b>单下划线</b> 开头的对象为 <b>保护成员</b>, 如 <code>_obj</code>.
</p>

<p>
<b>保护成员</b> 不能通过 <code>from module impport *</code> 的方式导入，但可以在使用 <code>import module</code> 导入模块后，通过 <code>module._obj</code> 的形式访问。
</p>

<p>
除此之外， <b>保护成员</b> 的行为与一般成员的行为 <b>无区别</b>.
</p></li>

<li><b>双下划线</b> 开头的对象为 <b>私有成员</b>, 只能由 <b>类对象</b> 自身进行访问。但可以通过 <code>_class__obj</code> 的形式强行访问。</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">In [1]: <span class="org-keyword">class</span> <span class="org-type">Test</span>(<span class="org-builtin">object</span>):
   ...:     <span class="org-keyword">def</span> <span class="org-function-name">__init__</span>(<span class="org-keyword">self</span>):
   ...:         <span class="org-keyword">self</span>._protect = 10
   ...:         <span class="org-keyword">self</span>.__private = 10
   ...:

In [2]: <span class="org-variable-name">t</span> = Test()

In [3]: t._protect
Out[3]: 10

In [4]: t.__private
---------------------------------------------------------------------------
<span class="org-type">AttributeError</span>                            Traceback (most recent call last)
&lt;ipython-<span class="org-builtin">input</span>-4-948bf5e358da&gt; <span class="org-keyword">in</span> &lt;module&gt;()
----&gt; 1 t.__private

<span class="org-type">AttributeError</span>: <span class="org-string">'Test'</span> <span class="org-builtin">object</span> has no attribute <span class="org-string">'__private'</span>

In [5]: t._Test__private
Out[5]: 10
</pre>
</div>
</div>
</div>

<div id="outline-container-org9851072" class="outline-3">
<h3 id="org9851072"><span class="section-number-3">3.5</span> 内置成员</h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li><p>
<code>__name__</code> <b>模块</b> 或 <b>类</b> 的名称， 如果 <b>模块</b> 是被直接执行的模块， <code>__name__</code> 的值为 <code>__main__</code>.
</p>

<div class="org-src-container">
<pre class="src src-python">In [7]: <span class="org-keyword">class</span> <span class="org-type">Test</span>(<span class="org-builtin">object</span>):
   ...:     <span class="org-keyword">pass</span>
   ...:

In [8]: Test.<span class="org-builtin">__name__</span>
Out[8]: <span class="org-string">'Test'</span>
</pre>
</div>

<p>
<b>注：</b> <b>类实例</b> 没有 <code>__name__</code> 属性。
</p></li>

<li><p>
<code>__dict__</code> 用来存储 <b>对象属性</b> 的一个字典， 其 <b>键</b> 为 <b>属性名</b>, <b>值</b> 为 <b>属性</b> 的值.
</p>

<p>
需要注意的是：
</p>
<ol class="org-ol">
<li>并不是所有对象都拥有 <code>__dict__</code> 属性， 许多内建类型就没有 <code>__dict__</code> 属性</li>

<li>实例的 <code>__dict__</code> 仅存储与该实例相关的实例属性</li>

<li>类的 <code>__dict__</code> 存储所有实例共享的变量和函数, 类的 <code>__dict__</code> 并不包含其父类的属性</li>
</ol></li>

<li><code>__doc__</code> 定义一个 <b>对象</b> 的 <b>文档字符串</b>.</li>

<li><code>__path__</code> 包含这个属性的 <b>模块</b> 会被当做一个 <b>包</b>.</li>

<li><code>__class__</code> 当前对象的类</li>
</ul>
</div>
</div>

<div id="outline-container-org61ed226" class="outline-3">
<h3 id="org61ed226"><span class="section-number-3">3.6</span> 生命周期</h3>
<div class="outline-text-3" id="text-3-6">
<p>
<code>Python</code> 的垃圾回收是根据 <b>引用计数</b> 来判断的， 当一个对象的 <b>引用</b> 为 0 时，该对象便会被回收。
</p>
</div>
</div>
</div>

<div id="outline-container-orga168584" class="outline-2">
<h2 id="orga168584"><span class="section-number-2">4</span> 作用域</h2>
<div class="outline-text-2" id="text-4">
<p>
<code>Python</code> 没有块级作用域, 也就是: <code>if/elif/else/ try/except for/while</code> 内定义的变量，外部也是可以访问的。
</p>

<div class="org-src-container">
<pre class="src src-python">In [1]: <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(10):
   ...:     <span class="org-keyword">pass</span>
   ...:

In [2]: i
Out[2]: 9
</pre>
</div>

<p>
LEGB 规则：
</p>
<pre class="example">
locals -&gt; enclosing function -&gt; globals -&gt; __builtins__
</pre>

<p>
参考：<a href="https://segmentfault.com/a/1190000000640834">理解 Python 的 LEGB - Sunisdown - SegmentFault 思否</a>
</p>
</div>

<div id="outline-container-orgdab2129" class="outline-3">
<h3 id="orgdab2129"><span class="section-number-3">4.1</span> 修改全局变量</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>内部函数， <b>不修改</b> 全局变量可以访问全局变量</li>
<li>内部函数， <b>修改</b> 同名全局变量，则 <code>python</code> 会认为它是一个局部变量</li>
</ol>

<p>
即： 如果在函数中对全局变量进行赋值修改， 就会出现 <code>Unbound-LocalError</code>.
</p>

<p>
<b>注</b>: 不仅是对于 <b>全局变量</b> 是这样， 对于所有 <b>父</b> 作用域的 <b>子</b> 作用域都是如此， 如嵌套函数等。
</p>

<div class="org-src-container">
<pre class="src src-python">In [1]: <span class="org-keyword">def</span> <span class="org-function-name">test</span>():        
   ...:     <span class="org-variable-name">name</span> = 10      
   ...:     <span class="org-keyword">def</span> <span class="org-function-name">in_test</span>(): 
   ...:         <span class="org-keyword">print</span>(name)
   ...:         <span class="org-variable-name">name</span> = 100 
   ...:     in_test()      
   ...:                    
In [2]: test()
---------------------------------------------------------------------------
<span class="org-type">UnboundLocalError</span>                         Traceback (most recent call last)
&lt;ipython-<span class="org-builtin">input</span>-4-ea594c21b25d&gt; <span class="org-keyword">in</span> &lt;module&gt;()
----&gt; 1 test()

&lt;ipython-<span class="org-builtin">input</span>-3-9edf775478c7&gt; <span class="org-keyword">in</span> test()
      4         <span class="org-keyword">print</span>(name)
      5         <span class="org-variable-name">name</span> = 100
----&gt; 6     in_test()
      7

&lt;ipython-<span class="org-builtin">input</span>-3-9edf775478c7&gt; <span class="org-keyword">in</span> in_test()
      2     <span class="org-variable-name">name</span> = 10
      3     <span class="org-keyword">def</span> <span class="org-function-name">in_test</span>():
----&gt; 4         <span class="org-keyword">print</span>(name)
      5         <span class="org-variable-name">name</span> = 100
      6     in_test()

<span class="org-type">UnboundLocalError</span>: local variable <span class="org-string">'name'</span> referenced before assignment
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc34a170" class="outline-2">
<h2 id="orgc34a170"><span class="section-number-2">5</span> 语法特性</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>Python 现在支持形如 <code>1_000_000_000</code> 的数字字面量，参考：<a href="https://www.python.org/dev/peps/pep-0515/">PEP 515 &#x2013; Underscores in Numeric Literals | Python.org</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc67066a" class="outline-2">
<h2 id="orgc67066a"><span class="section-number-2">6</span> 注意事项</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>Python 中存在一个小整数对象池， 这使得这些小整数在内存中只存在唯一的一个实例</li>
<li>异常处理时，finally 子句是必然会执行的，哪怕 try/catch 语句中存在 return</li>
<li>关键字 with 后不一定需要 as 子句，不过没有 as 会无法捕获上下文对象</li>
<li>关键字 as 可以在 import、except、with 之后使用</li>
<li><code>float('inf')</code> 和 <code>float('-inf')</code> 分别为正负无穷，而 <code>float('nan')</code> 为非数</li>
<li><p>
访问字典不存在的键时会调用方法 <code>__missing__</code>:
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">class</span> <span class="org-type">Counter</span>(<span class="org-builtin">dict</span>):
...     <span class="org-keyword">def</span> <span class="org-function-name">__missing__</span>(<span class="org-keyword">self</span>, key):
...         <span class="org-keyword">return</span> 0
&gt;&gt;&gt; <span class="org-variable-name">c</span> = Counter()
&gt;&gt;&gt; c[<span class="org-string">'red'</span>]
0
&gt;&gt;&gt; <span class="org-variable-name">c</span>[<span class="org-string">'red'</span>] += 1
&gt;&gt;&gt; c[<span class="org-string">'red'</span>]
1
</pre>
</div></li>
<li><p>
Python2 中的生成器不能有 return 语句：
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span class="org-keyword">def</span> <span class="org-function-name">cr</span>():
...     <span class="org-keyword">return</span> (<span class="org-keyword">yield</span> 10)
...
  File <span class="org-string">"&lt;stdin&gt;"</span>, line 2
<span class="org-type">SyntaxError</span>: <span class="org-string">'return'</span> <span class="org-keyword">with</span> argument inside generator
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
版权声明：本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'rgb-24bit';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
</div>
</body>
</html>
