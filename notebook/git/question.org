#+TITLE:      Git 问题集

* 目录                                                    :TOC_4_gh:noexport:
- [[#windows-上设置大小写敏感][Windows 上设置大小写敏感]]
- [[#git-push-冲突怎么办][git push 冲突怎么办]]
- [[#如何创建一个空提交][如何创建一个空提交]]
- [[#如何创建空白分支][如何创建空白分支]]
- [[#本地分支如何跟踪远程分支][本地分支如何跟踪远程分支]]
- [[#怎样创建-git-扩展][怎样创建 Git 扩展]]
- [[#怎样在存储库中保存本地配置][怎样在存储库中保存本地配置]]
- [[#git-checkout-reset-revert-的区别][git checkout, reset, revert 的区别]]
- [[#怎样查看存储库的大小][怎样查看存储库的大小]]
- [[#怎样批量删除过去提交中的文件][怎样批量删除过去提交中的文件]]
- [[#怎样批量更改过去提交中的邮箱和用户名][怎样批量更改过去提交中的邮箱和用户名]]
- [[#怎样撤销一个已经成功合并的-merge][怎样撤销一个已经成功合并的 merge]]
- [[#怎样指定子模块的分支][怎样指定子模块的分支]]
- [[#怎样更新远程分支的名称][怎样更新远程分支的名称]]
- [[#如何删除已提交但是位于-gitignore-的文件][如何删除已提交但是位于 .gitignore 的文件]]
- [[#git-命名的由来][Git 命名的由来]]
- [[#如何在-push-的时候同时向多个远程库推送代码][如何在 push 的时候同时向多个远程库推送代码]]

* Windows 上设置大小写敏感
  #+BEGIN_SRC bash
    git config core.ignorecase false  # 设置大小写敏感

    # 修改文件名为小写

    git rm -r --cached .  # 从版本库删除大写文件
    git push
  #+END_SRC

* git push 冲突怎么办
  向一个非空的存储库进行推送的时候可能产出冲突，这时可以这样做：
  #+BEGIN_EXAMPLE
   git remote add origin
   git pull --rebase origin master
   git add --all
   git ci
   git push
 #+END_EXAMPLE

* 如何创建一个空提交
  #+BEGIN_SRC bash
    $ git commit --allow-empty -m "Empty"
  #+END_SRC

* 如何创建空白分支
  1) 创建无提交历史的分支
     #+BEGIN_EXAMPLE
       $ git checkout --orphan <branch>
     #+END_EXAMPLE

  2) 删除工作目录中的内容
     #+BEGIN_EXAMPLE
       $ git rm -rf .
     #+END_EXAMPLE

  3) 创建提交
     #+BEGIN_EXAMPLE
       $ git commit -am "comment"
     #+END_EXAMPLE

* 本地分支如何跟踪远程分支
  #+BEGIN_EXAMPLE
    git branch -u
    git push -u
  #+END_EXAMPLE

* 怎样创建 Git 扩展
 1) 将可执行文件命名为 git-<name>
 2) 通过 git <name> 的方式调用

* 怎样在存储库中保存本地配置
  可以参考的解决方案：
  + 创建文件 ~.gitconfig~ 保存本地配置
  + 克隆存储库后执行：
    #+BEGIN_SRC bash
      git config --local include.path ../.gitconfig
    #+END_SRC

  参考：[[https://stackoverflow.com/questions/18329621/storing-git-config-as-part-of-the-repository][Storing git config as part of the repository - Stack Overflow]]

* git checkout, reset, revert 的区别
  #+BEGIN_EXAMPLE
    A -> B -> C -> D
                   ^
                  HEAD

    checkout:

    A -> B -> C -> D
         ^
        HEAD

    reset:

    A -> B
         ^
        HEAD


    revert:

    A -> B -> C -> D -> B
                        ^
                       HEAD
  #+END_EXAMPLE

* 怎样查看存储库的大小
  可以通过如下方式进行查看：
  #+BEGIN_EXAMPLE
    $ git bundle create tmp.bundle --all
    $ du -sh tmp.bundle
    $ rm tmp.bundle
  #+END_EXAMPLE

* 怎样批量删除过去提交中的文件
  使用 ~filter-branch~ 可以很好的完成这一任务，只不过需要强制推送：
  #+BEGIN_EXAMPLE
    $ git filter-branch --tree-filter "rm -f ..." HEAD
  #+END_EXAMPLE

* 怎样批量更改过去提交中的邮箱和用户名
  参考 [[https://stackoverflow.com/questions/750172/how-to-change-the-author-and-committer-name-and-e-mail-of-multiple-commits-in-gi][stackoverflow]] 中的回答，可以通过如下脚本完成这一任务：
  #+BEGIN_SRC sh
    git filter-branch --env-filter '
    OLD_EMAIL="your-old-email@example.com"
    CORRECT_NAME="Your Correct Name"
    CORRECT_EMAIL="your-correct-email@example.com"
    if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
    then
        export GIT_COMMITTER_NAME="$CORRECT_NAME"
        export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
    fi
    if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
    then
        export GIT_AUTHOR_NAME="$CORRECT_NAME"
        export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
    fi
    ' --tag-name-filter cat -- --branches --tags
  #+END_SRC

* 怎样撤销一个已经成功合并的 merge
  直接的操作方式：
  1. 首先通过 git relog 获得合并前的 commit sha
  2. 然后使用 git reset 重置 HEAD 指针就可以了
     
  参考：[[https://stackoverflow.com/questions/2389361/undo-a-git-merge-that-hasnt-been-pushed-yet][Undo a Git merge that hasn't been pushed yet - Stack Overflow]]

* 怎样指定子模块的分支
  可以通过 git submodule add -b 的方式指定分支，但是似乎存在一个问题：
  #+BEGIN_QUOTE
  只有将存储库克隆到本地后在添加才能在指定分支时不出错？
  #+END_QUOTE

* 怎样更新远程分支的名称
  更新本地分支名称和远程分支名称的指令：
  #+BEGIN_EXAMPLE
    $ git branch -m old-name new-name
    $ git push origin :old-name new-name
  #+END_EXAMPLE

  参考：[[https://www.w3docs.com/snippets/git/how-to-rename-git-local-and-remote-branches.html][How to rename git local and remote branches]]

* 如何删除已提交但是位于 .gitignore 的文件
  使用 ~git rm --cached <file>~ 就可以了，目录可以通过 ~git rm -r --cached <folder>~ 删除，参考：
  + [[https://stackoverflow.com/questions/1274057/how-to-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-gitignore][How to make Git "forget" about a file that was tracked but is now in .gitignore? - Stack Overflow]]

* Git 命名的由来
  参考：[[https://en.wikipedia.org/wiki/Git#Naming][Git#Naming - Wikipedia]]

* 如何在 push 的时候同时向多个远程库推送代码
  #+begin_src bash
    git remote set-url --add --push [remote] [original repo URL]
    git remote set-url --add --push [remote] [second repo URL]
  #+end_src

  参考：
  + [[https://gist.github.com/bjmiller121/f93cd974ff709d2b968f][Add multiple push URLs to a single git remote]]

