#+TITLE:      GCC & GDB

* 目录                                                    :TOC_4_gh:noexport:
- [[#gcc][GCC]]
  - [[#常用命令行选项][常用命令行选项]]
  - [[#生成的文件类型][生成的文件类型]]
  - [[#编译生成静态库][编译生成静态库]]
  - [[#选择编译标准][选择编译标准]]
  - [[#指定目标平台][指定目标平台]]
  - [[#指定应用程序图标][指定应用程序图标]]
- [[#gdb][GDB]]
  - [[#简单指令][简单指令]]
  - [[#使用技巧][使用技巧]]

* GCC
** 常用命令行选项
   |-------+---------------------------+--------------|
   | 选项  | 作用                      | 例子         |
   |-------+---------------------------+--------------|
   | -o    | 指定输出文件名            |              |
   | -Wall | 显示所有警告信息          |              |
   | -E    | 只输出预编译结果          |              |
   | -S    | 输出汇编代码              |              |
   | -c    | 输出目标文件              |              |
   | -g    | 生成供调试用的可执行文件, |              |
   | -l    | 指定所使用到的函数库      | -lmath       |
   | -L    | 指定函数库所在的文件夹    | -L../lib     |
   | -I    | 指定头文件所在的文件夹    | -I../include |
   |-------+---------------------------+--------------|

   注意事项：使用选项 -l、-L、-I 时参数和选项之间不能有空格。

** 生成的文件类型
   |--------+--------------------------------|
   | 扩展名 | 文件内容                       |
   |--------+--------------------------------|
   | .a     | 静态对象库                     |
   | .c     | 需要预处理的 C 语言源代码      |
   | .h     | C 语言源代码头文件             |
   | .i     | 无需预处理的 C 语言头文件      |
   | .o     | 目标文件, 格式和应用的连接相符 |
   | .s     | 汇编语言代码                   |
   | .so    | 共享对象库                     |
   |--------+--------------------------------|

** 编译生成静态库
   #+BEGIN_EXAMPLE
     $ ar -r libname targetfile...
   #+END_EXAMPLE

** 选择编译标准
   |-----------+---------------------------------|
   | 选项      | 描述                            |
   |-----------+---------------------------------|
   | -ansi     | 编译标准程序, 也和 GNU 后缀兼容 |
   | -pedantic | 严格按照标准, 提示警告信息      |
   | -std=c89  | ISO C89 标准                    |
   | -std=c99  | ISO C99 标准                    |
   |-----------+---------------------------------|

** 指定目标平台
   |------+-----------|
   | 选项 | 目标平台  |
   |------+-----------|
   | -m32 | 32 位系统 |
   | -m64 | 64 位系统 |
   |------+-----------|

** 指定应用程序图标
   + 需要工具： *windres*
   + 具体步骤：
     1. 准备好图标文件：example.ico
     2. 新建扩展名为 .rc 的文本文件，如：example.rc
     3. 添加以下内容：
        #+BEGIN_EXAMPLE
          1 ICON "example.ico"
        #+END_EXAMPLE
     4. 编译文件：
        #+BEGIN_EXAMPLE
          $ windres example.rc example.o
        #+END_EXAMPLE
     5. 编译应用程序:
        #+BEGIN_EXAMPLE
          gcc -o app app.o example.o
        #+END_EXAMPLE

* GDB
** 简单指令
   |-------+--------------------------------------|
   | 指令  | 作用                                 |
   |-------+--------------------------------------|
   | n     | 单步调试，执行下一条语句，不进入函数 |
   | s     | 单步跟踪，执行下一条语句，进入函数   |
   | p var | 打印变量的值                         |
   |-------+--------------------------------------|

** 使用技巧
   + 将函数代码和汇编指令映射起来
     #+BEGIN_EXAMPLE
       disas /m fun
     #+END_EXAMPLE

   + [[https://github.com/hellogcc/100-gdb-tips][hellogcc/100-gdb-tips: A collection of gdb tips. 100 maybe just mean many here.]]
   + [[https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html][gdb 调试利器 — Linux Tools Quick Tutorial]]

